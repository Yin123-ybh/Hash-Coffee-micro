# 地址和优惠券功能修复说明

## 问题描述
1. 订单确认页面加载地址失败，返回 404 错误
2. 优惠券列表加载失败，返回 404 错误

## 修复内容

### 1. 创建了地址相关代码
- **AddressService.java** - 地址服务接口
- **AddressServiceImpl.java** - 地址服务实现
- **AddressController.java** - 地址控制器
- **AddressMapper.xml** - 地址数据访问映射

### 2. 创建了用户优惠券控制器
- **UserCouponController.java** - 处理 `/user/coupons` 请求

### 3. 修改了网关配置

#### application.yml
添加了地址服务和用户优惠券服务的路由配置：
```yaml
# 地址服务 - 优先匹配
- id: address-service
  uri: lb://coffee-user-service
  predicates:
    - Path=/address/**
  filters:
    - StripPrefix=1

# 用户优惠券服务 - 优先匹配
- id: user-coupon-service
  uri: lb://coffee-coupon-service
  predicates:
    - Path=/user/coupons/**
  filters:
    - StripPrefix=1
```

#### GatewayConfig.java
添加了相应的路由配置。

## 重启服务
**重要：需要重启网关服务以使配置生效！**

在 IDEA 中重启 `coffee-gateway` 服务，或者使用命令：
```bash
cd coffee-microservices
./stop-services.sh
./start-services.sh
```

## 验证
重启后，测试以下接口：
1. `GET http://localhost:8089/address/list` - 应该返回地址列表
2. `GET http://localhost:8089/user/coupons?status=1` - 应该返回优惠券列表

## 关键点
1. **路由顺序很重要**：地址路由和优惠券路由必须在更通用的路由之前
2. **StripPrefix=1**：会删除 `/address` 前缀，最终转发到服务的 `/address/list`
3. **coffee-user-service** 处理地址相关请求
4. **coffee-coupon-service** 处理用户优惠券请求

