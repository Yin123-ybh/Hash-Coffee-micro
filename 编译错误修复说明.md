# ç¼–è¯‘é”™è¯¯ä¿®å¤è¯´æ˜

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. JwtUtils.java é‡å¤æ–¹æ³•å®šä¹‰é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
java: method getUsernameFromToken(java.lang.String) is already defined in class com.coffee.common.utils.JwtUtils
```

**åŸå› ï¼š**
`JwtUtils.java` ä¸­å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„ `getUsernameFromToken()` æ–¹æ³•ï¼ˆåˆ†åˆ«åœ¨ 77 è¡Œå’Œ 125 è¡Œï¼‰

**ä¿®å¤ï¼š**
åˆ é™¤äº†é‡å¤çš„æ–¹æ³•å®šä¹‰ï¼Œåªä¿ç•™ä¸€ä¸ªç‰ˆæœ¬

**æ–‡ä»¶ï¼š**
`coffee-common/src/main/java/com/coffee/common/utils/JwtUtils.java`

---

### 2. coffee-gateway æ‰¾ä¸åˆ° JwtUtils ç±»

**é”™è¯¯ä¿¡æ¯ï¼š**
```
java: package com.coffee.common.utils does not exist
```

**åŸå› ï¼š**
`coffee-gateway` çš„ `pom.xml` ä¸­ç¼ºå°‘ `coffee-common` ä¾èµ–

**ä¿®å¤ï¼š**
åœ¨ `coffee-gateway/pom.xml` ä¸­æ·»åŠ äº†ä¾èµ–ï¼ˆå¹¶æ’é™¤äº†å†²çªçš„ä¾èµ–ï¼‰ï¼š

```xml
<!-- å…¬å…±æ¨¡å— -->
<dependency>
    <groupId>com.coffee</groupId>
    <artifactId>coffee-common</artifactId>
    <version>1.0-SNAPSHOT</version>
    <exclusions>
        <!-- æ’é™¤ Spring MVC ä¾èµ–ï¼ŒGateway ä½¿ç”¨ WebFlux -->
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </exclusion>
        <!-- æ’é™¤ MyBatis ä¾èµ–ï¼ŒGateway ä¸éœ€è¦æ•°æ®åº“ -->
        <exclusion>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

**æ–‡ä»¶ï¼š**
`coffee-gateway/pom.xml`

---

### 3. Gateway å¯åŠ¨å¤±è´¥ï¼šSpring MVC å’Œ Spring Cloud Gateway å†²çª

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Spring MVC found on classpath, which is incompatible with Spring Cloud Gateway.
Please set spring.main.web-application-type=reactive or remove spring-boot-starter-web dependency.
```

**åŸå› ï¼š**
`coffee-common` æ¨¡å—åŒ…å«äº† `spring-boot-starter-web`ï¼Œè€Œ Gateway ä½¿ç”¨ WebFlux

**ä¿®å¤ï¼š**
åœ¨ç½‘å…³æ¨¡å—å¼•ç”¨ `coffee-common` æ—¶ï¼Œæ’é™¤ `spring-boot-starter-web` ä¾èµ–

**æ–‡ä»¶ï¼š**
`coffee-gateway/pom.xml`

---

## ğŸš€ æ¥ä¸‹æ¥éœ€è¦åšçš„

### 1. ç¼–è¯‘é¡¹ç›®

åœ¨ IDE ä¸­é‡æ–°æ„å»ºé¡¹ç›®ï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š

```bash
cd /Users/yin/Downloads/coffe1/coffee-microservices
mvn clean install -DskipTests
```

### 2. éªŒè¯ç¼–è¯‘

ç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½èƒ½æ­£å¸¸ç¼–è¯‘ï¼š
- âœ… `coffee-common` - å…¬å…±æ¨¡å—
- âœ… `coffee-gateway` - ç½‘å…³æœåŠ¡
- âœ… `coffee-user-service` - ç”¨æˆ·æœåŠ¡
- âœ… `coffee-product-service` - å•†å“æœåŠ¡
- âœ… `coffee-order-service` - è®¢å•æœåŠ¡ï¼ˆåŒ…å« OpenFeignï¼‰
- âœ… `coffee-coupon-service` - ä¼˜æƒ åˆ¸æœåŠ¡
- âœ… `coffee-cart-service` - è´­ç‰©è½¦æœåŠ¡

### 3. å¯åŠ¨æœåŠ¡

```bash
cd /Users/yin/Downloads/coffe1/coffee-microservices
./start-services.sh
```

---

## ğŸ“ ä¿®æ”¹æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `coffee-common/src/main/java/com/coffee/common/utils/JwtUtils.java` | åˆ é™¤é‡å¤çš„ `getUsernameFromToken()` æ–¹æ³• |
| `coffee-gateway/pom.xml` | æ·»åŠ  `coffee-common` ä¾èµ– |

---

## âœ… éªŒè¯æ¸…å•

- [ ] åœ¨ IDE ä¸­é‡æ–°ç¼–è¯‘é¡¹ç›®
- [ ] ç¡®è®¤æ²¡æœ‰ç¼–è¯‘é”™è¯¯
- [ ] å¯åŠ¨æ‰€æœ‰æœåŠ¡
- [ ] æµ‹è¯•ç½‘å…³åŠŸèƒ½
- [ ] æµ‹è¯• OpenFeign è°ƒç”¨

---

## ğŸ’¡ æç¤º

å¦‚æœ IDE ä»ç„¶æ˜¾ç¤ºé”™è¯¯ï¼š

1. **åˆ·æ–° Maven é¡¹ç›®**
   - åœ¨ IDEA ä¸­ï¼šå³é”®é¡¹ç›® â†’ Maven â†’ Reload Project
   - åœ¨ Eclipse ä¸­ï¼šå³é”®é¡¹ç›® â†’ Maven â†’ Update Project

2. **æ¸…ç†å¹¶é‡æ–°æ„å»º**
   ```bash
   mvn clean
   mvn install -DskipTests
   ```

3. **åˆ·æ–° IDE**
   - åœ¨ IDEA ä¸­ï¼šFile â†’ Invalidate Caches â†’ Invalidate and Restart

ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸ç¼–è¯‘äº†ï¼ğŸ‰
